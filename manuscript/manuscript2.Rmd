 
---
title: " Quantile Regression Analysis for Statin Effects on Body mass Index"
output:
    bookdown::pdf_document2:  
        keep_tex: true
bibliography: cite.bib
link_citations: true
header-includes:
    - \usepackage{setspace} 
    - \usepackage{float}
abstract: "My abstract"
keywords: "My keywords"
date: "`r format(Sys.time(), '%B %d, %Y')`"
geometry: margin=1in
fontsize: 12pt
fig_caption: yes
indent: true
---
\setstretch{4}
\section{introduction}

  High BMI has negative impact on public health. Due to high cost of obesity, it is crucial to get better understanding of the underlying risk factor for obesity. This can help decision makers to create a new regulation that help to prevent and to stop the dramatic increase in the BMI index. 
  
  Body Mass Index (BMI) plays an important role in predicting heart disease risk[@katbody]. Approximately, 18 million deaths annually per year are caused by cardiovascular diseases(CVD), and similar to this number of nonfatal cardiovascular events [@hay2017gbd].
In 2011, annual costs for CVD and stroke were $\$320.1$ billion, which is more than cancer cost. This cost includes \$195.6  billion in direct costs (healthcare costs), and the cost of future productivity loss is  \$124.5 [@mozaffarian2015executive]. Important factors associated with CVD are high body mass index (BMI) and abnormal lipid ratio  [@yusuf2004effect], [@anderson1991]. Lowering low-density lipoprotein (LDL) by using statin or other drugs reduces the risk of cardiovascular diseases even with a population with no CVD  [@yusuf2016]. Ferrieres et al. [@ferrieres2018] studied the effect of BMI on the choice of lipid-lowering treatment. It is been found that statin intensity increases with the high level of BMI($\rho=0.13$).

Taking cholesterol drug medication  associates with a high risk of elevating BMI level. It is been shown that statin users consume 192 additional calories per day which causes gaining a 6 lb to 11 lb. in a year. Statin users gain 1.3 units in the BMI measure while non-staining users gain 0.4 unit. Moreover, consumption of fat in statin users raised by 14.4%[@sugiyama2014].

 
 Logistic regression helps us to find out the group that has a higher odd of obesity, and ordinary least squares (OLS) regression helps us to study the effects of predictors on the average mean of the response. For example, estimating the association of different factors like a lipid-lowering drug with the conditional mean of BMI using OLS or logistic regression model[@ferrieres2018]. Both of these approaches do not give us insight into the predictor's effects on different quantiles of the responses.
   
  Quantile regression is used to investigate the heterogeneity in the association of the $\tau$th quantile of BMI with a set of independent predictors, that is investigate the effects of a specific predictors on the various quantiles of the BMI. BMI departs normality because of the skewness on the right and left tails [@flegal1999]. Estimation of underweight and overweight can be affected by the violation of normality. Quantile regression is a crucial tool used to estimate BMI with the dispersion of the association with predictors. 
  
  Quantile regression has many successful applications in ecology where different factors interact in a complicated way that produces different variations of one factor for different levels of another variable [@cade2003]. The association between BMI and the set of predictors; low childhood socioeconomic position, high maternal weight, low childhood general cognition  is stronger in the upper end of BMI quantile. This trend  is found in the UK population[@bann2020]. One cause of this heterogeneity is that risk factors may have stronger effect on patients with worse health, and these effects may diminishes when conditional mean of the BMI is studied. 
 
 
  We found that spline regressions produce a different estimate than polynomial regressions. Polynomial regression using the quadratic term of predictors forces the response to take convex or concave shape, see Figure 1.12 [@koenker2005]. This is because the limit of quadratic functions approach $\pm\infty$ as $x\rightarrow\pm\infty.$ However, when we model the predictor as splines the response is not forced to take a specific shape. In the latter case, different polynomials are constructed for the different regions in the range of predictors.
  
 \section{Quantile Regression}
Quantile regression is a tool used to regress the dependent variable with high variance over the independent variables. QR is developed to study the relationships between variables that have week or no-relationships between their means. One of the advantages of using QR over OLS is QR is robust for outliers.

For a random variable $X$, the cumulative distribution function (CDF) is $$F(X)=P(X\leq x),$$ and the $\tau$th quantile of $X$ is defined by $$ F^{-1}(\tau)=\text{inf}\{x: F(x)\ge \tau\} $$ where $0<\tau<1$.
Let the loss function is defined by $$\rho_{\tau}(u)= u(\tau-I_{(u<0)})$$ where $I$ is the indicator function  [@koenker2005]. The quantile estimator is the value that minimizes the expected loss function
 
$$E\rho_{\tau}(X-\hat{x})=(\tau-1)\int_{-\infty}^{\hat{x}} (x-\hat{x})dF(x)+\tau\int_{\hat{x}}^{-\infty} (x-\hat{x})dF(x).$$
Differentiating with respect to $\hat{x}$, we get
$$ 0  =(\tau-1)\int_{-\infty}^{\hat{x}} dF(x)+\tau\int_{\hat{x}}^{-\infty} dF(x)
=F(\hat{x})-\tau.$$
Due to the monotonicity of the cumulative distribution function, any solution that satisfies $\{x:F(x)=\tau \}$ is a minimizing for the expected loss function.

 
Least square method expresses conditional mean of y given x as $\mu(x)=x^T\beta$ and it solves $$ \underset{\beta\in \mathcal{R}^p}{\text{min}}\sum_{i=1}^n(y_i- x_i^T\beta)^2.$$ Quantile regression expresses conditional quantile function $Q_y(\tau|x)=x^T \beta ({\tau)}$ and solve $$ \underset{\beta\in \mathcal{R}^p}{\text{min}}\sum_{i=1}^n\rho_{\tau}(y_i- x_i^T\beta)^2.$$This minimization problem can be reformulated to a linear programming problem $$ \underset{\beta\in \mathcal{R}^p}{\text{min}} $$
 
\subsection{Quantile Regression Technique }

\subsection{splines}
   A continuous predictor can be linear, say $X$, or nonlinear, say $X^2$ depends on the relationship with the response variable. Most of the relations between the responses and predictors variables are complicated to the point that linear regressions are not suitable to model these relationships[@bruce2020]. For example, the response to different levels of drug doses is not a linear relationship. Linear regressions can be generalized to deal with nonlinear effects. One approach is through including polynomial terms in the regression equation. This approach is called Polynomial regression. The mathematical model for $n$ degree polynomial regression is shown in the Eq\eqref{non}
 \begin{equation}\label{non}
 y=\beta_0+\beta_1 X+\beta_2 X^2+\cdots+\beta_nX^n.
 \end{equation}  
 
 One of the limitations of using polynomial regression is the curvature that can be captured is limited with low order terms. However, including higher-order terms has a negative impact on the model by introducing undesirable "wiggliness" in the regression equation.  Another robust approach to model nonlinear relationships is splines. It is similar to a technique used by draftsmen in plotting curves. The spline is a process of constructing a set of piece-wise continuous
polynomials that are smoothly connected at a set of points in the range of the predictor variable. The connection points are called knots i.e. splines are used to smoothly interpolate between certain points. Let $a,b$ ,and $c$ are the endpoints of the $x$-axis intervals. A smooth cubic spline function is defined by the following equation.
\begin{equation}
f(X)=X\beta=\beta_{0}+\beta_{1}X+\beta_2X^2+\beta_{3}X^{3}+\beta_{4}(X-a)_{+}^3+\beta_{5}(X-b)_{+}^3+\beta_6(X-c)_{+}^3,
\end{equation}

where $$(u)_{+}=  
 \left\{
\begin{array}{ll}
u  & \mbox{if } u > 0 \\
0 & \mbox{if } u \leq 0
\end{array}
\right. $$

\section{Methods}
A multivariate quantile regression model is used to assess the characteristics of the association variability in different quantiles of the conditional distribution of the body mass index.
 
 The independent variables in our model are gender, race, age, total cholesterol, cholesterol drug use (yes or no). All types of cholesterol drugs are used including statins. The included races are non-Hispanic white, non-Hispanic black, Hispanic, or other.
 
\section{Numerical Example}
\subsection{Data}
 The data used in this study is National Health and Nutrition Examination Survey data (NHANES)[@NHANES]. The survey examines a nationally representative sample of the U.S. population. It focuses on a variety of health and nutrition measurements. The survey data are released every two years cycle.  In this study, we accumulated 6 cycles of NHANES data (2007â€“2018). We used two data files: One contains demographic variables, such as age, sex, race, income, etc., and the other contains data that are related to body measurements, such as BMI, head circumference, etc. These files are merged by using the respondent sequence number (SEQN)
 There are around 12,000 records. We selected a population age between 20 and 80.
 BMI are classified into different categories according to underweight, 18.5 kg/m2; normal weight, 18.5 to 25 kg/m2; overweight, 25 to 30 kg/m2; obese, 30 to 35 kg/m2; and very obese more than 35 kg/m2.  

| Syntax      | Male  | Female     |
| :---        |    :----:   |          ---: |
| count |  5990      | 6416   |
| Mean of Age | 49.9       | 49.73   |
| BMI        |  28.549    |  29.379  |
| TC         |        |    |
| Statin use (ratio) | 0.198       | 0.181   |

base_box_plot
 

```{r box, out.width = "100%", fig.align = "center", fig.cap = "Illustration of data distribution using a box plot. The plot compares cholesterol drug users vs non-cholesterol drug users", echo = FALSE}
# Created by file exploratory-data-analysis.R
if (!file.exists(here::here("images", "base_box_plot.png"))) {
    source(here::here("exploratory-data-analysis.R"))
}
knitr::include_graphics(here::here("images", "base_box_plot.png"))
```

 
Figure \@ref(fig:box) shows the association between age and BMI with respect to cholesterol drug is inconsistent. At the early age, the correlation is positive while at the middle age the correlation is almost flat, and at the old age the correlation is negative. Moreover, at low age cholesterol medications are  described only for a population with high BMI, but at a higher age, the difference in term of the BMI for a population that takes cholesterol medication and without cholesterol medication decreases until it diminishes as in the white population. The  heterogeneity can also be seen in gender ?, for the Hispanic female population, the cholesterol medication is taken by the population with lower BMI if compared to the population that does not take cholesterol medication.
```{r data, out.width = "80%", fig.align = "center", fig.cap = "A better figure caption", echo = FALSE}
# Created by file exploratory-data-analysis.R
if (!file.exists(here::here("images", "exploratory.png"))) {
    source(here::here("exploratory-data-analysis.R"))
}
knitr::include_graphics(here::here("images", "exploratory.png"))
```

 
 
```{r, out.width = "80%", fig.align = "center", fig.cap = "A better figure caption", echo = FALSE}
# Created by file exploratory-data-analysis.R
if (!file.exists(here::here("images", "exploratory2.png"))) {
    source(here::here("exploratory-data-analysis_JRT.R"))
}
knitr::include_graphics(here::here("images", "exploratory2.png"))
```

So,


```{r, out.width = "80%", fig.align = "center", fig.cap = "A better figure caption", echo = FALSE}
# Created by file exploratory-data-analysis.R
if (!file.exists(here::here("images", "quant90.png"))) {
    source(here::here("exploratory-data-analysis_JRT.R"))
}
knitr::include_graphics(here::here("images", "quant90.png"))
```


\section{Results}
The resulting estimate of effects on conditional mean of BMI level may not reflect the size and nature of these effects on lower or upper quantile. For example, in Figure \@ref(fig:resu1), the conditional mean effect of gender on BMI level is about -1, that is on average male's BMI is less than a female's BMI by one unit. However, the disparity of the gender effects on lower tails is much larger which is about 1, but the disparity is lower for the upper tail of the distribution somewhat around -3 unit.  



From the OLS it is obvious cholesterol drug users have on average higher BMI levels if compared to non-cholesterol drug users which are around 1.75. The disparity in BMI level for cholesterol drug users vs non-cholesterol drug users is almost the same for different Quantiles. cholesterol drug use seems to be associated with rather large effects on BMI levels somewhat around 1.5 to 1.7.  




```{r resu1, out.width = "100%", fig.align = "center", fig.cap = "A better figure caption", echo = FALSE}
# Created by file exploratory-data-analysis.R
if (!file.exists(here::here("images", "newfig.png"))) {
    source(here::here("exploratory-data-analysis_JRT.R"))
}
knitr::include_graphics(here::here("images", "newfig.png"))
```
 So,

```{r resu12, out.width = "100%", fig.align = "center", fig.cap = "A better figure caption", echo = FALSE}
# Created by file exploratory-data-analysis.R
if (!file.exists(here::here("images", "newfig11.png"))) {
    source(here::here("Q_reg_plot2.R"))
}
knitr::include_graphics(here::here("images", "newfig11.png"))
```


```{r resu122, out.width = "80%", fig.align = "center", fig.cap = "Using Cubic splines", echo = FALSE}
# Created by file exploratory-data-analysis.R
if (!file.exists(here::here("images", "newfig111.png"))) {
    source(here::here("exploratory-data-analysis_JRT.R"))
}
knitr::include_graphics(here::here("images", "newfig111.png"))
```
 

 Age effect modeled as a quadratic factor. The age effect is concave in general, see Figure \@ref(fig:resu3). At the lower quantile, BMI increases from age 20 to around age 50, and it starts to decrease after that. In the 55th quantile, the concavity is stronger at age 50 if compared to the left or right tail. The quadratic effect of age is reflected in the hyperbolic shape. However, the age effect modeled as b spline behaves in a different way. Age effect on BMI increases from age 20 to around age 36 and then start to decrease up to around age 63 then move up again and then decreases up to age 80, see Fig.\@ref(fig:resu33). The BMI trend in this modeling is close to the trend shown in [@chen2005] by using a complicated polynomial and log transformation for the response.
 
 
 

```{r resu3, out.width = "80%", fig.align = "center", fig.cap = "Illustration of the quadratic age effect on BMI leveles for four different quantiles of the conditional BMI distribution.  The ", echo = FALSE}
# Created by file exploratory-data-analysis.R
if (!file.exists(here::here("images", "p_age_effect.png"))) {
    source(here::here("exploratory-data-analysis_JRT.R"))
}
knitr::include_graphics(here::here("images", "p_age_effect.png"))
```
Using splines
```{r resu33, out.width = "80%", fig.align = "center", fig.cap = "Age effect modeled using bsplines ", echo = FALSE}
# Created by file exploratory-data-analysis.R
if (!file.exists(here::here("images", "s-age_effect.png")))
knitr::include_graphics(here::here("images", "s_age_effect.png"))
```

Using splines

```{r resu33g, out.width = "80%", fig.align = "center", fig.cap = "Age effect modeled using bsplines, ggplot plot ", echo = FALSE}
# Created by file exploratory-data-analysis.R
if (!file.exists(here::here("images", "Age_splin.png"))) {
    
}
knitr::include_graphics(here::here("images", "Age_splin.png"))
```
 

\ref{fig:resu33g}
Marginal quadratic cholesterol effect

```{r resu4, out.width = "80%", fig.align = "center", fig.cap = "Illustration of the quadratic cholestrol effect on BMI leveles for four different quantiles of the conditional BMI distribution.  The ", echo = FALSE}
# Created by file exploratory-data-analysis.R
if (!file.exists(here::here("images", "p_TC_effect.png"))) {
    source(here::here("exploratory-data-analysis_JRT.R"))
}
knitr::include_graphics(here::here("images", "p_TC_effect.png"))
```

Splines modeling

```{r resu330, out.width = "80%", fig.align = "center", fig.cap = " Illustration of marginal cholestrol effect modeled as B splines.  The ", echo = FALSE}
# Created by file exploratory-data-analysis.R
if (!file.exists(here::here("images", "s_TC_effect")))  
knitr::include_graphics(here::here("images", "s_TC_effect.png"))
```


```{r resu3330, out.width = "80%", fig.align = "center", fig.cap = " Illustration of marginal cholestrol effect modeled as B splines using ggplot.  The ", echo = FALSE}
# Created by file exploratory-data-analysis.R
if (!file.exists(here::here("images", "TC_splin")))  
knitr::include_graphics(here::here("images", "TC_splin.png"))
```


The quadratic effect of total cholesterol on the conditional distribution of BMI is convex.  At the lower tail, the correlation is positive that is as cholesterol increases the BMI increases. decreasing glucose level by somewhat around 1.4 up to around 180 Cholesterol level. However, at higher quantile the association become negative that is as cholesterol level increases the BMI decreases, see  Figure \@ref(fig:resu4). The relation between total cholesterol and fasting glucose has been studied in [@tsaousis2014],[@chang2011]. They found that there is a positive correlation between the two groups on average.    

On the other hand, when we use splines to modeled the total cholesterol, there is a huge difference in the shape of the association expect at the higher quantile there is some similarity. At the lower quantile, there is negative correlation between total cholesterol and BMI for total cholesterol in the range less than 160, then the correlation becomes positive for total cholesterol in the range of (170, 250). at the 55th quantile, the correlation is positive for low cholesterol level and then becomes almost flat for the rest cholesterol values. At a higher qunatile, the correlation becomes negative at cholesterol level in the range (160,300), see Figure \@ref(resu330).
 

\section{Conclusion}
 Multivariate quantile regression is used to study the effects of different risk factors on the BMI levels. Cholesterol drug effects on BMI is negligible at low quantile but at higher quantile cholesterol medication  effects on BMI is larger. This study showed that the association between BMI and total cholesterol is varying with repect to different quantile. 
 
 tota people who have TC levels around 190 mg/dL have the lowest fasting glucose levels for the lowest quantile, for the second quantile optimal cholesterol level is around 220mg/dL, and for the upper quantile, the optimal cholesterol level is around 200 mg/dL. Moreover, 
 
It is recommended to investigate why the effect estimates are varying across different BMI quantiles.

\newpage
\section{References}